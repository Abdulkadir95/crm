define("ebla-form:views/create",["view","view-record-helper"],function(e,s){return e.extend({template:"ebla-form:create",events:{"click #btn-submit-ebla-form":function(){this.getView("edit").save()}},data:function(){return{logoSrc:this.getLogoSrc(),welcomeMessage:this.options.welcomeMessage,showLogo:this.options.showLogo,thankYou:this.thankYou,reCaptchaSiteKey:this.reCaptchaSiteKey}},setup:function(){this.scope=this.options.scope,this.reCaptchaSiteKey=this.getConfig().get("reCaptchaSiteKey");var e=window.location.search.substring(1).split("&");let a={};const i={};e.forEach(function(e){e=e.split("=");1<e.length&&(a[e[0]]=decodeURIComponent(e[1]))}),a=_.extend(a,this.options.defaultValues?.defaultValues||{}),this.getModelFactory().create(this.options.scope,t=>{(this.model=t).urlRoot="EblaForm/save/"+Espo.eblaFormId,t.id=this.entityId,t.set(a);var e={el:this.options.el+" .edit-container",scope:this.scope,detailLayout:this.options.detailLayout,recordHelper:new s,model:t,mode:"edit",returnUrl:"",returnDispatchParams:{controller:"EblaForm",action:"thanks",options:{isReturn:!0}},params:i};this.createView("edit","ebla-form:views/record/edit",e,e=>{t.id&&t.fetch(),e.on("before:save",()=>{Espo.Ui.notify(this.translate("pleaseWait","messages")),this.$submit.addClass("disabled").attr("disabled","disabled"),this.$submit.addClass("disabled").attr("disabled","disabled")}),e.on("after:save",()=>{this.notify(!1),this.thankYou=this.options.thanksMessage||this.getLanguage().translate("Done"),this.reRender()}),e.on("error:save",()=>{this.notify(!1),this.$submit.removeClass("disabled").removeAttr("disabled")})})})},getLogoSrc:function(){var e=this.getConfig().get("companyLogoId");return e?this.getBasePath()+"?entryPoint=LogoImage&id="+e:this.getBasePath()+"client/img/logo.png"},afterRender:function(){e.prototype.afterRender.call(this),this.$submit=this.$el.find("#btn-submit-ebla-form"),this.reCaptchaSiteKey&&"undefined"!=typeof grecaptcha&&grecaptcha.render("g-recaptcha",{sitekey:this.reCaptchaSiteKey,callback:this.captchaCallBack.bind(this),"expired-callback":this.captchaCallBack.bind(this),"error-callback":this.captchaCallBack.bind(this)})},captchaCallBack:function(e){this.model.set("reCaptchaToken",e)}})});